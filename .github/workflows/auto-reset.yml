name: Auto Reset
run-name: Reset test branch
on:
  push:
    branches:
      - feat/test-auto-reset

jobs:
  # create:
  #   uses: ./.github/workflows/force-push.yml
  #   secrets: inherit
  #   permissions:
  #     contents: write
  #     id-token: write
  #   with:
  #     base_branch: "master"
  #     target_branch: "reset-shared-staging"

  approval:
    runs-on: ubuntu-latest
    needs: create
    environment: auto-reset
    run: echo "Approved!"

  shared_staging:
    needs: approval
    steps:
      - name: create shared staging
        uses: ./.github/workflows/force-push.yml
        with:
          base_branch: "reset-shared-staging"
          target_branch: "feat/shared-staging"
      - name: delete temp branch
        uses: ./.github/workflows/delete-branch.yml
        with:
          delete_branch: "reset-shared-staging"